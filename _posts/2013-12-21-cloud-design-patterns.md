---
layout: post
title:  "내가 생각하는 쓸만한 AWS 클라우드 디자인 패턴"
date:   2013-12-21 23:55:55
categories: k
permalink: /cloud-design-patterns
image: http://farm6.staticflickr.com/5493/11346327516_76ed85abd0_o.jpg
---


얼마전부터 청소년 투표권 연령 인하를 위해 [사이트](http://1618vote.net)를 기획하면서 이벤트성 사이트에서 
어떤방법으로 손쉽게 스케일링(Scaling; 시스템을 분산해서 대규모 트래픽을 처리하는것)을 할수있는지 고민하던차에 
몇가지 방법을 정리해본다.

**다이렉트 호스팅**

AWS의 `정적` 파일 호스팅 서비스인 Simple Storage Service(이하 S3)에서 폼을 포함한 HTML파일을 호스팅하고 
그것의 응답한것을 EC2에서 PHP를 처리하고 RDS로 데이터베이스를 구성한다.

여기서 중요한것은 [s3fs](https://code.google.com/p/s3fs/)라는 것으로 EC2에서 S3의 버킷을 EC2 디렉토리에 마운트할수 있다. 

사실 설문조사를 할경우 순수 HTML로만 폼을 만들고 그것을 `action`을 통해서 원하는 위치의 스크립트로 쏴주기만하면 되니 
간단한 편이다.

우리는 한 머신에 설치되어 있는 LAMP에 익숙하다. 리눅스를 기반으로 Apache나 nginx웹서버에 PHP를 올려서 쓴다. 하지만 이벤트성 사이트에서는 
철저한 분리를 통해, 같은 양의 하드웨어로 더욱 많은 성능을 낼수있다.

**부하분산**

*웹서버와 애플리케이션서버 부하분산*

만약 하나의 머신이 감당할 수 있는 최대의 요청을 넘어서는 수준의 트래픽을 처리하려면 어떻게 해야 될까? 
나도 항상 궁금했는데, AWS상에서는 Elastic Load Balancing(이하 ELB)을 통해서 여러대의 EC2머신으로 분산을 시키면 된다. 

ELB의 원리, 더 크게 보아서 로드 밸런싱의 원리는 간단하다. 요청 a, b, c, d가 동시에 들어온다면 그 아래있는 웹서버 
1, 2, 3, 4로 날려준다. 그러면 전체적으로보면 꽤 만은 요청이지만 머신 한개당 처리할 요청은 그리 많지 않으므로, 궁극적으로 분산시스템을 만들 수 있다.

*데이터 베이스 부하분산*

데이터베이스의 경우 쓰기에 소모되는 CPU부하가 읽기보다 휠씬 많다는것을 알 수있다. case by case로 알아보자.

-카카오톡

폐쇠적인 구조로 쓰기가 상당히 많은 편이다. 채팅방에 있는 소수의 사람들에게만 내용이 보이기때문에 쓰기에 초점을둔 
Sharding(이하 샤딩)이란 기법을 사용해야된다. 예를들어보면, 데이터베이스 a, b, c, b가 있다고 생각하자. 만약 
당신이 카톡 메시지 1, 2, 3, 4를 보낸다면 통상적으로 하나의 데이터베이스에 row 4개가 만들어지면서, 
